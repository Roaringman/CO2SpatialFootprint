<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Home</title>
		<link rel="stylesheet" type="text/css" href="css\stylesheet.css">
		<script src="https://d3js.org/d3.v3.min.js"></script>
		<script src="https://d3js.org/d3.geo.projection.v0.min.js"></script>
		<script src="https://d3js.org/topojson.v1.min.js"></script>
		<script src="http://maps.googleapis.com/maps/api/js?libraries=geometry"></script> 
		<script src="js/main.js"></script>
		
		<script src="libraries/d3.js" type="text/javascript" charset="utf-8"></script>
		<script src="libraries/d3-geo.js" type="text/javascript" charset="utf-8"></script>
		<script src="libraries/d3.geo.projection.v0.min.js" type="text/javascript" charset="utf-8"></script>

		<script src="libraries/topojson.v1.min.js" type="text/javascript" charset="utf-8"></script>


		<style type="text/css">
			#ani_map {
    			width: 400px;
    			height: 400px;
			}
		</style>

	</head>

	<body>
		<div class="nav">
			<ul class="nav">
				<li class="nav"><a class="navactive" href="index.html">Home</a></li>
				<li class="nav"><a class="nav" href="about.html">About</a></li>
				<li class="plane"></li>
				<li class="tree"></li>
			</ul>
		</div>


		<div class="box1">
			<h1>Select your flight</h1>
			
			<form id="originform" onsubmit="handle" autocomplete = "off"  >
				<input type="text" placeholder="Start Airport" value = "" id="origintb" size="30" onkeyup="showResult(this.value, this, event.keyCode, event)">
				<div id="resultor"></div>
			</form>
			<form id="destform" onsubmit="handle" autocomplete = "off"  >
				<input type="text" id="desttb" size="30" placeholder="Destination Airport" onkeyup="showResult(this.value, this, event.keyCode, event)">
				<div id="resultde"></div>
			</form>
			
			
			
			<div id="svgmap">

				
			</div>
			
			
			
			
		</div>


		<div class="box2">
			<h1>Flight Animation</h1>
			
			<div id="ani_map">
			</div>
			<p>This is for the prototype only. In the end the animation is supposed to be integrated into the d3 map and of course should display a route between the two chosen points. It is not planned to use the google maps api in the end. This is only used here for demonstration purposes. Berlin (origin) and New York (destination) are the examples for this route.</p>
			<p>Also, the HTML/CSS frame needs to be adjusted to the boxes, once they are set up</p>
		</div>


		<div class="box3">
			<h1>BOX3</h1>
			<div id="secondmap"></div>
		</div>

		<div class="box4">
			<h1>BOX4</h1>
		</div>

		<script>

			// ------------------------ GOOGLE MAPS ANIMATION function start ------------------------
			// To be deleted or replaced in the final version. Prototype only!!

			var mapOptions = {
			    center: { lat: 0, lng: 0 },
			    zoom: 1
			};
			var mapEl = document.getElementById('ani_map');
			var map = new google.maps.Map(mapEl, mapOptions);

			var coords = [
			    {lat: 52.51, lng: 13.4},
			    {lat: 40.71, lng: -74},
			];
			  
			var polyline = new google.maps.Polyline({
			    path: coords,
			    geodesic: true,
			    strokeColor: '#FF0000',
			    strokeOpacity: 1.0,
			    strokeWeight: 2,
			    map: map
			});

			var marker = new google.maps.Marker({
			    position: coords[0],
			    map: map ,
			    icon: {
			    	url: "img/airplane.svg",
			    	size: new google.maps.Size(50,50),
			    	origin: new google.maps.Point(0, 0),
			    	anchor: new google.maps.Point(25, 25),
			    	scaledSize: new google.maps.Size(50,50)
			    }
			});

			// ------------------------ main program for animation ------------------------

			var DURATION = 10000;

			var length = google.maps.geometry.spherical.computeLength(polyline.getPath().getArray()),
			    startTime = Date.now();

			var pos = 0;

			var interpolator = gPolyInterpolator(polyline);

			// this function will be called in every frame
			function frame() {
			    var time = Date.now() - startTime;
			    if (time > DURATION) {
			        // stop (no new animation frame is requested
			        return;
			    }
			    
			    var pos = length * time / DURATION;
			    
			    var coords = interpolator(pos);
			    
			    marker.setPosition(coords);
			    
			    window.requestAnimationFrame(frame);
			}

			// start animation
			frame();

			// ------------------------ interpolation function ------------------------

			// returns a function to interpolate along a google maps polyline / polygon 
			function gPolyInterpolator(polyline) {
			    if (!google.maps.geometry.spherical) {
			        console.error("This function requires the google.maps.geometry.spherical library!");
			        console.error("Load it as described at https://developers.google.com/maps/documentation/javascript/libraries");
			        return null;
			    }
			    
			    var path = polyline.getPath();
			    
			    return function(distance) {
			    
			        var numVertices = path.getLength();
			    
			        if (distance <= 0) return path.getAt(0);
			        if (numVertices < 2) return path.getAt(0);
			        
			        var distNext = 0,
			            distLast = 0;
			        
			        for (var i=1; (i < numVertices && distNext < distance); i++) {
			            distLast = distNext;
			            distNext += google.maps.geometry.spherical.computeDistanceBetween(path.getAt(i), path.getAt(i-1));
			        }
			        if (distNext < distance) {
			            return path.getAt(numVertices-1);
			        }
			        
			        var alpha = (distance-distLast)/(distNext-distLast);
			        
			        return google.maps.geometry.spherical.interpolate(path.getAt(i-2), path.getAt(i-1), alpha);
			    }
			}

			// ------------------------ GOOGLE MAPS ANIMATION function end ------------------------

		</script>
		
	</body>

</html>